<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soft Elixir</title>
  <link rel="stylesheet" href="stylesheets/dev.css">
</head>
<body>
  <div class="container">
    <header>
      <a href="."><h1>Soft Elixir</h1></a>
      <nav>
        <div>{<s><a href="#">demo</a></s>}</div>
        <div>{<a href="features">features</a>}</div>
        <div>{<a href="dev">dev notes</a>}</div>
      </nav>
    </header>
    <nav class="vertical">
  <div>{<a href="#sequencing">sequencing</a>}</div>
  <div>{<a href="#pattern-editor">pattern editor</a>}</div>
  <div>{<a href="#rendering">rendering</a>}</div>
</nav>

<h2 id="sequencing">Sequencing</h2>
<h2 id="pattern-editor">Pattern editor</h2>
<p>The heart of a tracker-based sequencer is the <a href="https://www.renoise.com/sites/default/files/images/screenshots/pattern-editor-300.png">pattern editor</a>â€”a grid of cells into which audio events can be entered.</p>
<p>I want Soft Elixir to have first-class keyboard navigation, so it&#39;s important that moving around in the pattern editor feels snappy and intuitive.</p>
<div class="grid-demo">
  <div class="grid-text">
    <h3>Grid demo</h3>
    <p>Navigate using arrow keys.</p>
    <p>Enter data with number keys. Clear with [ d ].</p>
    <br />
    <h3>Modifiers</h3>
    <ul>
      <li>[ a + arrow ] :: move to the end of the grid in the specified direction</li>
      <li>[ s + arrow-up ] :: increment number by one</li>
      <li>[ s + arrow-down ] :: decrement number by one</li>
      <li>[ s + arrow-right ] :: increment number by ten</li>
      <li>[ s + arrow-left ] :: decrement number by ten</li>
    </ul>
  </div>
  <grid-numbers></grid-numbers>
</div>

<p>The grid control is built with my <a href="https://github.com/patrick-mcgreal-dev/custom-element/blob/master/custom-element.ts">custom element class</a> as a base. This utility class provides me with the following: </p>
<ul>
<li>A type-safe model that allows me to inject it with attributes</li>
<li>A system for implementing keyboard controls, including the ability to use modifier keys</li>
</ul>
<h2 id="rendering">Rendering</h2>
<p>The demo version of Soft Elixir renders its display using DOM elements. As a web-developer, the DOM is a very intuitive way of working. It&#39;s also extremely inefficient when it comes to producing a constantly moving grid of data.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/OffscreenCanvas">Off-screen canvas rendering</a> has obvious advantages. We can push expensive animation operations to a separate thread via a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">web worker</a> in order to protect the main processing thread.</p>
<p>By implementing a simple <code>drawArea</code> function, we draw only what should currently be visible:</p>
<pre><code>drawArea(top: number, bottom: number, left: number, right: number) {

  // clear canvas
  // ...

  // draw visible area
  for (let col = left; col &lt;= right; col++) {
    for (let row = top; row &lt;= bottom; row++) {
      // draw cell at [col, row]
    }
  }

}
</code></pre>
<p>To handle user navigation and input, a DOM element can be placed on top of the canvas. By locking the position of this DOM element to column width and row height, we can produce the effect of navigating the grid:</p>
<video controls>
  <source src="/assets/canvas-1.mov" type="video/mp4">
</video>
  </div>
</body>
<script src="js/dev.js"></script>
</html>